(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[332],{3382:e=>{e.exports={container:"HistoryList_container__p_g0j",list:"HistoryList_list__r0vQn",entry:"HistoryList_entry__deD3D",entryText:"HistoryList_entryText__a_Awv",remaining:"HistoryList_remaining__hBozm",rollbackBtn:"HistoryList_rollbackBtn__1hdTa"}},4626:e=>{e.exports={message:"ResultMessage_message__cyL_Q"}},5597:e=>{e.exports={wrapper:"GuessInput_wrapper__y0TJF",slots:"GuessInput_slots__0ol2z",slot:"GuessInput_slot__dxLu6",actions:"GuessInput_actions__QBa2D",pasteInputContainer:"GuessInput_pasteInputContainer__SpyiP",pasteInput:"GuessInput_pasteInput__eXRLi",pasteBtn:"GuessInput_pasteBtn__K2Zga",submitBtn:"GuessInput_submitBtn__FQBUa",loading:"GuessInput_loading__FsJ_U",pickerOverlay:"GuessInput_pickerOverlay__3As8f",pickerPanel:"GuessInput_pickerPanel__K0MQE",pickerBtn:"GuessInput_pickerBtn__q0rbU",deleteBtn:"GuessInput_deleteBtn__d_nSn"}},6383:e=>{e.exports={overlay:"CandidateList_overlay__6viYv",panel:"CandidateList_panel__xC3BH",closeBtn:"CandidateList_closeBtn__Rgo3z",listItem:"CandidateList_listItem__S93QJ",loading:"CandidateList_loading__yR3_5"}},6490:()=>{},6709:e=>{e.exports={container:"ResultHistory_container__36bOs",table:"ResultHistory_table__tjpZy",cell:"ResultHistory_cell__XNwZd",delBtn:"ResultHistory_delBtn___D0TQ"}},6760:(e,t,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return s(9884)}])},7360:e=>{e.exports={container:"Home_container__9OuOz",appHeader:"Home_appHeader__iAQVw",digitSelect:"Home_digitSelect__AOBV8",buttonRow:"Home_buttonRow__7q2rh",showCands:"Home_showCands__M6vIq",reset:"Home_reset__b0Om0",historyBtn:"Home_historyBtn__jDAU8"}},9884:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>O});var n=s(7876),a=s(4232),l=s(8106),i=s(6724),r=s.n(i);let c=null,o=null,d="hitblow-db";async function u(){if(c||(c=await r()({locateFile:()=>"/sql-wasm.wasm"})),!o){let e=localStorage.getItem(d);if(e){let t=Uint8Array.from(atob(e),e=>e.charCodeAt(0));o=new c.Database(t)}else(o=new c.Database).run("CREATE TABLE IF NOT EXISTS results (\n           id INTEGER PRIMARY KEY AUTOINCREMENT,\n           digit_count INTEGER,\n           attempts INTEGER,\n           elapsed_ms INTEGER,\n           played_at TEXT\n         );"),m()}return o}function m(){if(!o)return;let e=btoa(String.fromCharCode(...o.export()));localStorage.setItem(d,e)}async function h(e,t,s){let n=(await u()).prepare("INSERT INTO results (digit_count, attempts, elapsed_ms, played_at) VALUES (?, ?, ?, ?)"),a=new Date().toISOString();n.run([e,t,s,a]),n.free(),m()}async function _(){let e=(await u()).exec("SELECT * FROM results ORDER BY id DESC;");if(!e.length)return[];let{columns:t,values:s}=e[0];return s.map(e=>t.reduce((t,s,n)=>(t[s]=e[n],t),{}))}async function p(e){(await u()).run("DELETE FROM results WHERE id = ?;",[e]),m()}function x(e){let t=Array.from({length:10},(e,t)=>t.toString());return Array.from({length:e},()=>{let e=Math.floor(Math.random()*t.length);return t.splice(e,1)[0]}).join("")}let g={};function j(e){if(g[e])return g[e];let t=[];return!function s(n,a){if(n.length===e)return void t.push(n);for(let e=0;e<10;e++)a&1<<e||s(n+e.toString(),a|1<<e)}("",0),g[e]=t,t}let y=(0,l.v)((e,t)=>({digitCount:4,secret:x(4),history:[],message:"",candidates:j(4),candidatesHistory:[j(4)],startTime:Date.now(),setDigitCount:t=>{let s=Math.max(1,Math.min(10,t)),n=j(s);e({digitCount:s,secret:x(s),history:[],message:"",candidates:n,candidatesHistory:[n],startTime:Date.now()})},reset:()=>{let s=t().digitCount,n=j(s);e({secret:x(s),history:[],message:"",candidates:n,candidatesHistory:[n],startTime:Date.now()})},checkGuess:async s=>{let{digitCount:n,secret:a,history:l,candidates:i,candidatesHistory:r}=t(),c=0,o=0;for(let e=0;e<n;e++)s[e]===a[e]?c++:a.includes(s[e])&&o++;let d=[...l,{guess:s,hit:c,blow:o}],u=i.filter(e=>{let t=0,a=0;for(let l=0;l<n;l++)e[l]===s[l]?t++:s.includes(e[l])&&a++;return t===c&&a===o}),m=[...r,u];if(e({history:d,candidates:u,candidatesHistory:m,message:c===n?"正解！秘密の数字は ".concat(a," でした。"):"".concat(c," Hit, ").concat(o," Blow")}),c===n){let e=Date.now()-t().startTime;await h(n,d.length,e)}},rollbackTo:s=>{let n=t().history.slice(0,s),a=t().candidatesHistory.slice(0,s+1),l=a[a.length-1];e({history:n,candidatesHistory:a,candidates:l,message:""})},remainingCandidatesAt:e=>{var s,n;return null!=(n=null==(s=t().candidatesHistory[e+1])?void 0:s.length)?n:0}})),f=(0,l.v)(e=>({theme:localStorage.getItem("theme")||"light",toggleTheme:()=>e(e=>{let t="light"===e.theme?"dark":"light";return localStorage.setItem("theme",t),document.documentElement.setAttribute("data-theme",t),{theme:t}})}));var N=s(5597),w=s.n(N);function v(e){let{}=e,t=y(e=>e.digitCount),s=y(e=>e.checkGuess),[l,i]=(0,a.useState)(Array(t).fill("")),[r,c]=(0,a.useState)(""),[o,d]=(0,a.useState)(!1),[u,m]=(0,a.useState)(!1),[h,_]=(0,a.useState)(0),[p,x]=(0,a.useState)(null),[g,j]=(0,a.useState)(!1);(0,a.useEffect)(()=>{i(Array(t).fill("")),c("")},[t]);let f=(0,a.useMemo)(()=>Array.from({length:10},(e,t)=>t),[]);function N(){j(!1),x(null)}let v=(0,a.useMemo)(()=>l.every(e=>""!==e)&&new Set(l).size===t,[l,t]);async function C(){if(!v||o)return;d(!0);let e=Date.now(),n=window.setTimeout(()=>m(!0),3e3),a=window.setInterval(()=>{_(Date.now()-e)},100);await new Promise(e=>setTimeout(e,0)),await s(l.join("")),i(Array(t).fill("")),c(""),clearTimeout(n),clearInterval(a),d(!1),m(!1),_(0)}let b=(0,a.useMemo)(()=>{let e=Math.floor(h/1e3),t=h%1e3;return"".concat(e,".").concat(String(t).padStart(3,"0")," 秒")},[h]);return(0,n.jsxs)("div",{className:w().wrapper,children:[(0,n.jsx)("div",{className:w().slots,children:l.map((e,t)=>(0,n.jsx)("div",{className:w().slot,onClick:()=>{x(t),j(!0)},children:e||"ー"},t))}),(0,n.jsxs)("div",{className:w().actions,children:[(0,n.jsxs)("div",{className:w().pasteInputContainer,children:[(0,n.jsx)("input",{className:w().pasteInput,value:r,onChange:e=>c(e.target.value),placeholder:"".concat(t,"桁の数字を貼り付け"),maxLength:t}),(0,n.jsx)("button",{className:w().pasteBtn,disabled:o,onClick:function(){let e=r.trim();return e.length!==t?void alert("".concat(t,"桁の文字列を貼り付けてください")):/^\d+$/.test(e)&&new Set(e).size===t?void i(e.split("")):void alert("重複なく数字のみを貼り付けてください")},children:"貼付"})]}),(0,n.jsx)("button",{className:w().submitBtn,disabled:!v||o,onClick:C,children:"判定"})]}),o&&(0,n.jsxs)("div",{className:w().loading,children:[(0,n.jsx)("p",{children:"判定中…"}),u&&(0,n.jsxs)("p",{children:["経過時間: ",b]})]}),g&&(0,n.jsx)("div",{className:w().pickerOverlay,onClick:N,children:(0,n.jsxs)("div",{className:w().pickerPanel,onClick:e=>e.stopPropagation(),children:[f.map(e=>(0,n.jsx)("button",{className:w().pickerBtn,onClick:()=>(function(e){if(null===p)return;let t=[...l];t[p]=String(e),i(t),N()})(e),disabled:l.includes(String(e)),children:e},e)),(0,n.jsx)("button",{className:"".concat(w().pickerBtn," ").concat(w().deleteBtn),onClick:function(){if(null===p)return;let e=[...l];e[p]="",i(e),N()},children:"削除"})]})})]})}var C=s(4626),b=s.n(C);function S(e){let{}=e,t=y(e=>e.message);return t?(0,n.jsx)("p",{className:b().message,children:t}):null}var I=s(3382),E=s.n(I);function k(e){let{}=e,t=y(e=>e.history),s=y(e=>e.remainingCandidatesAt),a=y(e=>e.rollbackTo),l=e=>{let t=e>0?"".concat(e+1,"回目からやり直しますか？"):"最初からやり直しますか？";window.confirm("".concat(t,"\n以降の履歴は削除されます。"))&&a(e)};return(0,n.jsxs)("div",{className:E().container,children:[(0,n.jsx)("h2",{children:"履歴"}),0===t.length?(0,n.jsx)("p",{children:"まだ履歴がありません。"}):(0,n.jsx)("ul",{className:E().list,children:t.map((e,t)=>(0,n.jsxs)("li",{className:E().entry,children:[(0,n.jsxs)("span",{className:E().entryText,children:[t+1,"回目: ",e.guess," - ",e.hit," Hit, ",e.blow," Blow"]}),(0,n.jsxs)("span",{className:E().remaining,children:["残り候補: ",s(t)]}),(0,n.jsx)("button",{className:E().rollbackBtn,onClick:()=>l(t),children:"↓ ここ以降を取り消す"})]},t))})]})}var T=s(6383),B=s.n(T);function H(e){let{onClose:t}=e,s=y(e=>e.candidates),[l,i]=(0,a.useState)(!0),[r,c]=(0,a.useState)([]),[o,d]=(0,a.useState)(!1),[u,m]=(0,a.useState)(0);(0,a.useEffect)(()=>{let e,t;return async function(){e=setTimeout(()=>{d(!0);let e=Date.now();t=setInterval(()=>{m(Date.now()-e)},100)},3e3),await new Promise(e=>setTimeout(e,0)),c(s),clearTimeout(e),clearInterval(t),i(!1)}(),()=>{clearTimeout(e),clearInterval(t)}},[s]);let h=(0,a.useMemo)(()=>{let e=Math.floor(u/1e3),t=u%1e3;return"".concat(e,".").concat(String(t).padStart(3,"0")," 秒")},[u]);return(0,n.jsx)("div",{className:B().overlay,onClick:t,children:(0,n.jsxs)("div",{className:B().panel,onClick:e=>e.stopPropagation(),children:[(0,n.jsx)("button",{className:B().closeBtn,onClick:t,children:"閉じる"}),l?(0,n.jsxs)("div",{className:B().loading,children:[(0,n.jsx)("p",{children:"候補を生成中…"}),o&&(0,n.jsxs)("p",{children:["経過時間: ",h]})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("h2",{children:["残り候補 (",r.length,")"]}),(0,n.jsx)("div",{className:B().list,children:r.map(e=>(0,n.jsx)("span",{className:B().listItem,children:e},e))})]})]})})}var R=s(6709),A=s.n(R);function D(){let[e,t]=(0,a.useState)([]),s=async()=>{t(await _())};(0,a.useEffect)(()=>{s()},[]);let l=async e=>{confirm("本当にこの履歴を削除しますか？")&&(await p(e),s())};return(0,n.jsxs)("div",{className:A().container,children:[(0,n.jsx)("h2",{children:"プレイ履歴"}),0===e.length?(0,n.jsx)("p",{children:"まだ履歴がありません。"}):(0,n.jsxs)("table",{className:A().table,children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{className:A().cell,children:"操作"}),(0,n.jsx)("th",{className:A().cell,children:"桁数"}),(0,n.jsx)("th",{className:A().cell,children:"回数"}),(0,n.jsx)("th",{className:A().cell,children:"時間 (秒)"}),(0,n.jsx)("th",{className:A().cell,children:"日時"})]})}),(0,n.jsx)("tbody",{children:e.map(e=>(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{className:A().cell,children:(0,n.jsx)("button",{className:A().delBtn,onClick:()=>l(e.id),children:"削除"})}),(0,n.jsx)("td",{className:A().cell,children:e.digit_count}),(0,n.jsx)("td",{className:A().cell,children:e.attempts}),(0,n.jsx)("td",{className:A().cell,children:(e.elapsed_ms/1e3).toFixed(2)}),(0,n.jsx)("td",{className:A().cell,children:new Date(e.played_at).toLocaleString()})]},e.id))})]})]})}function L(){let{theme:e,toggleTheme:t}=f(),[s,l]=(0,a.useState)(!1);return((0,a.useEffect)(()=>{l(!0)},[]),s)?(0,n.jsx)("button",{onClick:t,className:"theme-toggle",children:"dark"===e?"ライトモードへ切替":"ダークモードへ切替"}):null}var G=s(7360),M=s.n(G);function O(){let e=y(),{theme:t}=f(),[s,l]=(0,a.useState)(!1),[i,r]=(0,a.useState)(!1);return(0,a.useEffect)(()=>{document.documentElement.setAttribute("data-theme",t)},[t]),(0,n.jsxs)("main",{className:M().container,children:[(0,n.jsxs)("header",{className:M().appHeader,children:[(0,n.jsxs)("h1",{children:["Hit & Blow Next.js版 (",e.digitCount,"桁)"]}),(0,n.jsx)(L,{})]}),(0,n.jsxs)("p",{children:[e.digitCount,"桁の数字を当ててください（各桁異なる）"]}),(0,n.jsxs)("div",{className:M().digitSelect,children:[(0,n.jsx)("label",{htmlFor:"digitCount",children:"桁数:"}),(0,n.jsx)("select",{id:"digitCount",value:e.digitCount,onChange:t=>e.setDigitCount(+t.target.value),children:Array.from({length:10},(e,t)=>t+1).map(e=>(0,n.jsxs)("option",{value:e,children:[e,"桁"]},e))})]}),(0,n.jsx)(v,{}),(0,n.jsx)(S,{}),(0,n.jsx)(k,{}),(0,n.jsxs)("div",{className:M().buttonRow,children:[(0,n.jsx)("button",{className:M().showCands,onClick:()=>l(!0),children:"残り候補を表示"}),(0,n.jsx)("button",{className:M().reset,onClick:e.reset,children:"再スタート"}),(0,n.jsx)("button",{className:M().historyBtn,onClick:()=>r(e=>!e),children:i?"履歴を閉じる":"プレイ履歴を表示"})]}),s&&(0,n.jsx)(H,{onClose:()=>l(!1)}),i&&(0,n.jsx)(D,{})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[513,143,636,593,792],()=>t(6760)),_N_E=e.O()}]);