(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[332],{1747:e=>{e.exports={message:"ResultMessage_message__cyL_Q"}},4040:e=>{e.exports={container:"Home_container__9OuOz",appHeader:"Home_appHeader__iAQVw",digitSelect:"Home_digitSelect__AOBV8",buttonRow:"Home_buttonRow__7q2rh",showCands:"Home_showCands__M6vIq",reset:"Home_reset__b0Om0",historyBtn:"Home_historyBtn__jDAU8"}},5714:e=>{e.exports={overlay:"CandidateList_overlay__6viYv",panel:"CandidateList_panel__xC3BH",closeBtn:"CandidateList_closeBtn__Rgo3z",listItem:"CandidateList_listItem__S93QJ",loading:"CandidateList_loading__yR3_5",filterInput:"CandidateList_filterInput__w_UNa",filterSlots:"CandidateList_filterSlots__NGwWg",filterSlot:"CandidateList_filterSlot__SGQwO",slotWrapper:"CandidateList_slotWrapper__LP3iB",filterPickerOverlay:"CandidateList_filterPickerOverlay__ujXLD",filterPickerPanel:"CandidateList_filterPickerPanel__Hftso",filterPickerBtn:"CandidateList_filterPickerBtn__yahZ3",filterPickerClear:"CandidateList_filterPickerClear__DtV6a",limitNotice:"CandidateList_limitNotice__8SGUV",listItemButton:"CandidateList_listItemButton__Z16i6"}},5932:e=>{e.exports={container:"ResultHistory_container__36bOs",table:"ResultHistory_table__tjpZy",cell:"ResultHistory_cell__XNwZd",delBtn:"ResultHistory_delBtn___D0TQ"}},6490:()=>{},6760:(e,t,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return s(8630)}])},8335:e=>{e.exports={container:"HistoryList_container__p_g0j",list:"HistoryList_list__r0vQn",entry:"HistoryList_entry__deD3D",entryText:"HistoryList_entryText__a_Awv",remaining:"HistoryList_remaining__hBozm",rollbackBtn:"HistoryList_rollbackBtn__1hdTa"}},8630:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>O});var n=s(7876),l=s(4232),a=s(8106),i=s(6724),r=s.n(i);let c=null,o=null,d="hitblow-db";async function u(){if(c||(c=await r()({locateFile:e=>"".concat("/hitblow-next","/").concat(e)})),!o){let e=localStorage.getItem(d);if(e){let t=Uint8Array.from(atob(e),e=>e.charCodeAt(0));o=new c.Database(t)}else(o=new c.Database).run("CREATE TABLE IF NOT EXISTS results (\n           id INTEGER PRIMARY KEY AUTOINCREMENT,\n           digit_count INTEGER,\n           attempts INTEGER,\n           elapsed_ms INTEGER,\n           played_at TEXT\n         );"),_()}return o}function _(){if(!o)return;let e=btoa(String.fromCharCode(...o.export()));localStorage.setItem(d,e)}async function m(e,t,s){let n=(await u()).prepare("INSERT INTO results (digit_count, attempts, elapsed_ms, played_at) VALUES (?, ?, ?, ?)"),l=new Date().toISOString();n.run([e,t,s,l]),n.free(),_()}async function h(){let e=(await u()).exec("SELECT * FROM results ORDER BY id DESC;");if(!e.length)return[];let{columns:t,values:s}=e[0];return s.map(e=>t.reduce((t,s,n)=>(t[s]=e[n],t),{}))}async function p(e){(await u()).run("DELETE FROM results WHERE id = ?;",[e]),_()}function x(e){let t=Array.from({length:10},(e,t)=>t.toString());return Array.from({length:e},()=>{let e=Math.floor(Math.random()*t.length);return t.splice(e,1)[0]}).join("")}let g={};function f(e){if(g[e])return g[e];let t=[];return!function s(n,l){if(n.length===e)return void t.push(n);for(let e=0;e<10;e++)l&1<<e||s(n+e.toString(),l|1<<e)}("",0),g[e]=t,t}let j=(0,a.v)((e,t)=>({digitCount:4,secret:x(4),history:[],message:"",candidates:f(4),candidatesHistory:[f(4)],startTime:Date.now(),currentGuess:[,,,,].fill(""),setCurrentGuess:t=>e({currentGuess:t}),setDigitCount:t=>{let s=Math.max(1,Math.min(10,t)),n=f(s);e({digitCount:s,secret:x(s),history:[],message:"",candidates:n,candidatesHistory:[n],startTime:Date.now(),currentGuess:Array(s).fill("")})},reset:()=>{let s=t().digitCount,n=f(s);e({secret:x(s),history:[],message:"",candidates:n,candidatesHistory:[n],startTime:Date.now(),currentGuess:Array(s).fill("")})},checkGuess:async s=>{let{digitCount:n,secret:l,history:a,candidates:i,candidatesHistory:r}=t(),c=0,o=0;for(let e=0;e<n;e++)s[e]===l[e]?c++:l.includes(s[e])&&o++;let d=[...a,{guess:s,hit:c,blow:o}],u=i.filter(e=>{let t=0,l=0;for(let a=0;a<n;a++)e[a]===s[a]?t++:s.includes(e[a])&&l++;return t===c&&l===o}),_=[...r,u];if(e({history:d,candidates:u,candidatesHistory:_,message:c===n?"正解！秘密の数字は ".concat(l," でした。"):"".concat(c," Hit, ").concat(o," Blow")}),c===n){let e=Date.now()-t().startTime;await m(n,d.length,e)}},rollbackTo:s=>{let n=t().history.slice(0,s),l=t().candidatesHistory.slice(0,s+1),a=l[l.length-1];e({history:n,candidatesHistory:l,candidates:a,message:""})},remainingCandidatesAt:e=>{var s,n;return null!=(n=null==(s=t().candidatesHistory[e+1])?void 0:s.length)?n:0}})),C=(0,a.v)(e=>({theme:localStorage.getItem("theme")||"light",toggleTheme:()=>e(e=>{let t="light"===e.theme?"dark":"light";return localStorage.setItem("theme",t),document.documentElement.setAttribute("data-theme",t),{theme:t}})}));var N=s(5714),y=s.n(N);function v(e){let{onClose:t,onSelectCandidate:s}=e,a=j(e=>e.setCurrentGuess),i=j(e=>e.candidates),[r,c]=(0,l.useState)(!0),[o,d]=(0,l.useState)([]),[u,_]=(0,l.useState)(null),[m,h]=(0,l.useState)(!1),[p,x]=(0,l.useState)(0);(0,l.useEffect)(()=>{console.log("CandidateList onSelectCandidate prop:",s)},[s]),(0,l.useEffect)(()=>{i.length>0&&(d(Array(i[0].length).fill("")),c(!1))},[i]),(0,l.useEffect)(()=>{let e,t;return e=setTimeout(()=>{h(!0);let e=Date.now();t=setInterval(()=>x(Date.now()-e),100)},3e3),()=>{clearTimeout(e),clearInterval(t)}},[i]);let g=(0,l.useMemo)(()=>o.every(e=>""===e)?i:i.filter(e=>o.every((t,s)=>""===t||e[s]===t)),[i,o]),f=(0,l.useMemo)(()=>g.slice(0,1e3),[g]),C=(0,l.useMemo)(()=>{let e=Math.floor(p/1e3),t=p%1e3;return"".concat(e,".").concat(String(t).padStart(3,"0")," 秒")},[p]),N=g.length<=10;return(0,n.jsx)("div",{className:y().overlay,onClick:t,children:(0,n.jsxs)("div",{className:y().panel,onClick:e=>e.stopPropagation(),children:[(0,n.jsx)("button",{className:y().closeBtn,onClick:t,children:"閉じる"}),r?(0,n.jsxs)("div",{className:y().loading,children:[(0,n.jsx)("p",{children:"候補を生成中…"}),m&&(0,n.jsxs)("p",{children:["経過時間: ",C]})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:y().filterSlots,children:o.map((e,t)=>(0,n.jsxs)("div",{className:y().slotWrapper,children:[(0,n.jsx)("button",{className:y().filterSlot,onClick:()=>_(u===t?null:t),children:e||"ー"}),u===t&&(0,n.jsxs)("div",{className:y().filterPickerPanel,children:[Array.from({length:10},(e,t)=>String(t)).map(e=>(0,n.jsx)("button",{className:y().filterPickerBtn,disabled:o.includes(e),onClick:()=>{d(s=>{let n=[...s];return n[t]=e,n}),_(null)},children:e},e)),(0,n.jsx)("button",{className:y().filterPickerClear,disabled:""===o[t],onClick:()=>{d(e=>{let s=[...e];return s[t]="",s}),_(null)},children:"削除"})]})]},t))}),(0,n.jsxs)("h2",{children:["残り候補 (",g.length,")"]}),g.length>1e3&&(0,n.jsx)("p",{className:y().limitNotice,children:"※先頭1000件のみ表示しています"}),N&&(0,n.jsx)("p",{className:y().buttonNotice,children:"候補が10件以下になりました。番号を選択してください。"}),(0,n.jsx)("div",{className:y().list,children:N?g.map(e=>(0,n.jsx)("button",{className:y().listItemButton,style:{backgroundColor:"#4a90e2",color:"#fff"},onClick:()=>{console.log("CandidateList clicked:",e),s?s(e):a(e.split("")),t()},children:e},e)):f.map(e=>(0,n.jsx)("span",{className:y().listItem,children:e},e))})]})]})})}var w=s(9010),S=s.n(w);function k(e){let{}=e,t=j(e=>e.digitCount),s=j(e=>e.checkGuess),a=j(e=>e.currentGuess),i=j(e=>e.setCurrentGuess),[r,c]=(0,l.useState)(!1),[o,d]=(0,l.useState)(""),[u,_]=(0,l.useState)(!1),[m,h]=(0,l.useState)(!1),[p,x]=(0,l.useState)(0),[g,f]=(0,l.useState)(null),[C,N]=(0,l.useState)(!1);(0,l.useEffect)(()=>{i(Array(t).fill("")),d("")},[t,i]);let y=(0,l.useMemo)(()=>Array.from({length:10},(e,t)=>t),[]);function w(){N(!1),f(null)}let k=(0,l.useMemo)(()=>a.every(e=>""!==e)&&new Set(a).size===t,[a,t]);async function b(){if(!k||u)return;_(!0);let e=Date.now(),n=window.setTimeout(()=>h(!0),3e3),l=window.setInterval(()=>x(Date.now()-e),100);await new Promise(e=>setTimeout(e,0)),await s(a.join("")),i(Array(t).fill("")),d(""),clearTimeout(n),clearInterval(l),_(!1),h(!1),x(0)}let I=(0,l.useMemo)(()=>{let e=Math.floor(p/1e3),t=p%1e3;return"".concat(e,".").concat(String(t).padStart(3,"0")," 秒")},[p]);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:S().wrapper,children:[(0,n.jsx)("div",{className:S().slots,children:a.map((e,t)=>(0,n.jsx)("div",{className:S().slot,onClick:()=>{f(t),N(!0)},children:e||"ー"},t))}),(0,n.jsxs)("div",{className:S().actions,children:[(0,n.jsxs)("div",{className:S().pasteInputContainer,children:[(0,n.jsx)("input",{className:S().pasteInput,value:o,onChange:e=>d(e.target.value),placeholder:"".concat(t,"桁の数字を貼り付け"),maxLength:t}),(0,n.jsx)("button",{className:S().pasteBtn,disabled:u,onClick:function(){let e=o.trim();return e.length!==t?void alert("".concat(t,"桁の文字列を貼り付けてください")):/^\d+$/.test(e)&&new Set(e).size===t?void i(e.split("")):void alert("重複なく数字のみを貼り付けてください")},children:"貼付"})]}),(0,n.jsx)("button",{className:S().submitBtn,disabled:!k||u,onClick:b,children:"判定"})]}),u&&(0,n.jsxs)("div",{className:S().loading,children:[(0,n.jsx)("p",{children:"判定中…"}),m&&(0,n.jsxs)("p",{children:["経過時間: ",I]})]}),C&&(0,n.jsx)("div",{className:S().pickerOverlay,onClick:w,children:(0,n.jsxs)("div",{className:S().pickerPanel,onClick:e=>e.stopPropagation(),children:[y.map(e=>(0,n.jsx)("button",{className:S().pickerBtn,onClick:()=>(function(e){if(null===g)return;let t=[...a];t[g]=String(e),i(t),w()})(e),disabled:a.includes(String(e)),children:e},e)),(0,n.jsx)("button",{className:"".concat(S().pickerBtn," ").concat(S().deleteBtn),onClick:function(){if(null===g)return;let e=[...a];e[g]="",i(e),w()},disabled:null===g||""===a[g],children:"削除"})]})})]}),r&&(0,n.jsx)(v,{onClose:()=>c(!1),onSelectCandidate:function(e){console.log("GuessInput received candidate:",e),i(e.split("")),c(!1)}})]})}var b=s(1747),I=s.n(b);function B(e){let{}=e,t=j(e=>e.message);return t?(0,n.jsx)("p",{className:I().message,children:t}):null}var E=s(8335),T=s.n(E);function L(e){let{}=e,t=j(e=>e.history),s=j(e=>e.remainingCandidatesAt),l=j(e=>e.rollbackTo),a=e=>{let t=e>0?"".concat(e+1,"回目からやり直しますか？"):"最初からやり直しますか？";window.confirm("".concat(t,"\n以降の履歴は削除されます。"))&&l(e)};return(0,n.jsxs)("div",{className:T().container,children:[(0,n.jsx)("h2",{children:"履歴"}),0===t.length?(0,n.jsx)("p",{children:"まだ履歴がありません。"}):(0,n.jsx)("ul",{className:T().list,children:t.map((e,t)=>(0,n.jsxs)("li",{className:T().entry,children:[(0,n.jsxs)("span",{className:T().entryText,children:[t+1,"回目: ",e.guess," - ",e.hit," Hit, ",e.blow," Blow"]}),(0,n.jsxs)("span",{className:T().remaining,children:["残り候補: ",s(t)]}),(0,n.jsx)("button",{className:T().rollbackBtn,onClick:()=>a(t),children:"↓ ここ以降を取り消す"})]},t))})]})}var H=s(5932),G=s.n(H);function A(){let[e,t]=(0,l.useState)([]),s=async()=>{t(await h())};(0,l.useEffect)(()=>{s()},[]);let a=async e=>{confirm("本当にこの履歴を削除しますか？")&&(await p(e),s())};return(0,n.jsxs)("div",{className:G().container,children:[(0,n.jsx)("h2",{children:"プレイ履歴"}),0===e.length?(0,n.jsx)("p",{children:"まだ履歴がありません。"}):(0,n.jsxs)("table",{className:G().table,children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{className:G().cell,children:"操作"}),(0,n.jsx)("th",{className:G().cell,children:"桁数"}),(0,n.jsx)("th",{className:G().cell,children:"回数"}),(0,n.jsx)("th",{className:G().cell,children:"時間 (秒)"}),(0,n.jsx)("th",{className:G().cell,children:"日時"})]})}),(0,n.jsx)("tbody",{children:e.map(e=>(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{className:G().cell,children:(0,n.jsx)("button",{className:G().delBtn,onClick:()=>a(e.id),children:"削除"})}),(0,n.jsx)("td",{className:G().cell,children:e.digit_count}),(0,n.jsx)("td",{className:G().cell,children:e.attempts}),(0,n.jsx)("td",{className:G().cell,children:(e.elapsed_ms/1e3).toFixed(2)}),(0,n.jsx)("td",{className:G().cell,children:new Date(e.played_at).toLocaleString()})]},e.id))})]})]})}function P(){let{theme:e,toggleTheme:t}=C(),[s,a]=(0,l.useState)(!1);return((0,l.useEffect)(()=>{a(!0)},[]),s)?(0,n.jsx)("button",{onClick:t,className:"theme-toggle",children:"dark"===e?"ライトモードへ切替":"ダークモードへ切替"}):null}var R=s(4040),D=s.n(R);function O(){let e=j(),{theme:t}=C(),[s,a]=(0,l.useState)(!1),[i,r]=(0,l.useState)(!1);return(0,l.useEffect)(()=>{document.documentElement.setAttribute("data-theme",t)},[t]),(0,n.jsxs)("main",{className:D().container,children:[(0,n.jsxs)("header",{className:D().appHeader,children:[(0,n.jsxs)("h1",{children:["Hit & Blow Next.js版 (",e.digitCount,"桁)"]}),(0,n.jsx)(P,{})]}),(0,n.jsxs)("p",{children:[e.digitCount,"桁の数字を当ててください（各桁異なる）"]}),(0,n.jsxs)("div",{className:D().digitSelect,children:[(0,n.jsx)("label",{htmlFor:"digitCount",children:"桁数:"}),(0,n.jsx)("select",{id:"digitCount",value:e.digitCount,onChange:t=>e.setDigitCount(+t.target.value),children:Array.from({length:10},(e,t)=>t+1).map(e=>(0,n.jsxs)("option",{value:e,children:[e,"桁"]},e))})]}),(0,n.jsx)(k,{}),(0,n.jsx)(B,{}),(0,n.jsx)(L,{}),(0,n.jsxs)("div",{className:D().buttonRow,children:[(0,n.jsx)("button",{className:D().showCands,onClick:()=>a(!0),children:"残り候補を表示"}),(0,n.jsx)("button",{className:D().reset,onClick:e.reset,children:"再スタート"}),(0,n.jsx)("button",{className:D().historyBtn,onClick:()=>r(e=>!e),children:i?"履歴を閉じる":"プレイ履歴を表示"})]}),s&&(0,n.jsx)(v,{onClose:()=>a(!1)}),i&&(0,n.jsx)(A,{})]})}},9010:e=>{e.exports={wrapper:"GuessInput_wrapper__y0TJF",slots:"GuessInput_slots__0ol2z",slot:"GuessInput_slot__dxLu6",actions:"GuessInput_actions__QBa2D",pasteInputContainer:"GuessInput_pasteInputContainer__SpyiP",pasteInput:"GuessInput_pasteInput__eXRLi",pasteBtn:"GuessInput_pasteBtn__K2Zga",submitBtn:"GuessInput_submitBtn__FQBUa",loading:"GuessInput_loading__FsJ_U",pickerOverlay:"GuessInput_pickerOverlay__3As8f",pickerPanel:"GuessInput_pickerPanel__K0MQE",pickerBtn:"GuessInput_pickerBtn__q0rbU",deleteBtn:"GuessInput_deleteBtn__d_nSn"}}},e=>{var t=t=>e(e.s=t);e.O(0,[513,143,636,593,792],()=>t(6760)),_N_E=e.O()}]);